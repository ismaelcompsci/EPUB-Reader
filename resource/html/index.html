<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EPUB.js Highlights Example</title>
    <script src="qrc:///reader/js/epub.min.js"></script>
    <script src="qrc:///reader/js/jszip.min.js"></script>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>

    <style type="text/css">
      /* .epub-container {
        min-width: 320px; */
      /* margin: 0 auto; */
      /* position: relative;
      } */

      .epub-container .epub-view > iframe {
        background: white;
        box-shadow: 0 0 4px #ccc;
        /*margin: 10px;
          padding: 20px;*/
      }

      #viewer {
        position: absolute;
        width: 100vw;
        height: 100vh;

        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <script src="qrc:///reader/js/epub.min.js"></script>
    <script src="qrc:///reader/js/jszip.min.js"></script>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>

    <div id="viewer"></div>
    <script>
      window.addEventListener("load", function () {
        new QWebChannel(qt.webChannelTransport, function (channel) {
          backend = channel.objects.backend;
          backend.getFile(function (pyval) {
            console.log(pyval);
            // "D:/Calibre_Books/Alastair%20Reynolds/Eversion%20(95)/Eversion%20-%20Alastair%20Reynolds.epub"
            // Load the opf or book

            var book = ePub(pyval);

            var rendition = book.renderTo("viewer", {
              manager: "continuous",
              flow: "scrolled",
              width: "100%",
              height: "100%",
            });

            var displayed = rendition.display();

            // Navigation loaded
            book.loaded.navigation.then(function (toc) {
              // console.log(toc);
            });

            var keyListener = function (e) {
              // Left Key
              if ((e.keyCode || e.which) == 37) {
                rendition.prev();
              }

              // Right Key
              if ((e.keyCode || e.which) == 39) {
                rendition.next();
              }
            };

            rendition.on("keyup", keyListener);
            document.addEventListener("keyup", keyListener, false);
          });
        });
      });
    </script>
  </body>
</html>
